<!DOCTYPE html>
<html>
    <head>
        <title>Web Tools</title>
        <link rel="icon" type="image/x-icon" class="js-site-favicon" href="https://github.githubassets.com/favicon.ico">
        <!-- axios -->
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    </head>
    <!-- body content -->
    <body id="body" style="text-align: center;">
        <!-- index div -->
        <div id="index">
            <p>Web Tools</p>
            <p>
                <a href="javascript:void(0)" onclick="show_tool_1()">1. print diff lines </a>
            </p>
            <p>
                <a href="javascript:void(0)" onclick="show_tool_2()">2. format string match sql in operator </a>
            </p>
            <p>
                <a href="javascript:void(0)" onclick="show_tool_3()">3. decode url string </a>
            </p>
            <p>
                <a href="javascript:void(0)" onclick="show_tool_4()">4. show trade </a>
            </p>
        </div>
        <!-- 1. print diff lines div -->
        <div id="tool_1" style="display:none">
            <p>1. print diff lines</p>
            <p>
                <a href="javascript:void(0)" onclick="show_index()">back to the index</a>
            </p>
            <br>
            <div>
                <!-- aa textarea -->
                <textarea id="textarea_aa" rows="13" cols="30" placeholder="aa textarea , please input some string on diff lines"></textarea>
                <!-- bb textarea -->
                <textarea id="textarea_bb" rows="13" cols="30" placeholder="bb textarea , please input some string on diff lines"></textarea>
            </div>
            <div>
                <!-- share textarea-->
                <textarea id="textarea_share" rows="13" cols="30" placeholder="show share lines" readonly></textarea>
                <!-- only aa textarea -->
                <textarea id="textarea_only_aa" rows="13" cols="30" placeholder="show only in aa textarea" readonly></textarea>
                <!-- only bb textarea -->
                <textarea id="textarea_only_bb" rows="13" cols="30" placeholder="show only in bb textarea" readonly></textarea>
            </div>
            <div>
                <!-- button -->
                <input value="print diff" type="button" onclick="print_diff(false)">
                <input value="print diff with count" type="button" onclick="print_diff(true)">
                <input value="clean data" type="button" onclick="clean_tool_1()">
            </div>
        </div>
        <!-- 2. format string match sql in operator -->
        <div id="tool_2" style="display:none">
            <p>2. format string match sql in operator</p>
            <p>
                <a href="javascript:void(0)" onclick="show_index()">back to the index</a>
            </p>
            <br>
            <div>
                <!-- before format string -->
                <textarea id="before_string" rows="13" cols="30" placeholder="input list of string"></textarea>
                <!-- after format string -->
                <textarea id="after_string" rows="13" cols="30" placeholder="show formatted string" readonly></textarea>
            </div>
            <div>
                <!-- button -->
                <input value="format string" type="button" onclick="format_string()">
                <input value="clean data" type="button" onclick="clean_tool_2()">
            </div>
        </div>
        <!-- 3. decode url string -->
        <div id="tool_3" style="display:none">
            <p>3. decode url string</p>
            <p>
                <a href="javascript:void(0)" onclick="show_index()">back to the index</a>
            </p>
            <br>
            <div>
                <!-- before decode string -->
                <textarea id="before_decode_string" rows="13" cols="30" placeholder="input encode string"></textarea>
                <!-- after decode string -->
                <textarea id="after_decode_string" rows="13" cols="30" placeholder="show decode string" readonly></textarea>
            </div>
            <div>
                <!-- button -->
                <input value="decode string" type="button" onclick="decode_string()">
                <input value="clean data" type="button" onclick="clean_tool_3()">
            </div>
        </div>
        <!-- 4. show trade -->
        <div id="tool_4" style="display:none">
            <p>4. show trade </p>
            <p>
                <a href="javascript:void(0)" onclick="show_index()">back to the index</a>
            </p>
            <br>
            <div>
                <select id="trade_select_code"> 
                    <option value ="s_sh" selected>s_sh</option>
                    <option value ="s_sz">s_sz</option>
                  </select>
            </div>
            <div>
                <textarea id="trade_code" rows="5" cols="30" placeholder="input code"></textarea>
            </div>
            <div>
                <textarea id="trade_result" rows="5" cols="30" placeholder="show result" readonly></textarea>
            </div>
            <div>
                <!-- button -->
                <input value="refresh" type="button" onclick="trade_refresh()">
                <input value="stop" type="button" onclick="stopInterval()">
            </div>
        </div>
    </body>
    <script>
        //index function ---
        function show_index(){
            clean_tool_1();
            clean_tool_2();
            clean_tool_3();
            clean_tool_4();
            document.getElementById("tool_1").style.display='none';
            document.getElementById("tool_2").style.display='none';
            document.getElementById("tool_3").style.display='none';
            document.getElementById("tool_4").style.display='none';
            document.getElementById("index").style.display='inline';
        }
        //tool 1 function ---
        function clean_tool_1(){
            document.getElementById("textarea_only_aa").innerHTML='';
            document.getElementById("textarea_only_bb").innerHTML='';
            document.getElementById("textarea_share").innerHTML='';
            document.getElementById("textarea_aa").value='';
            document.getElementById("textarea_bb").value='';
        }
        function show_tool_1(){
            document.getElementById("index").style.display='none';
            document.getElementById("tool_1").style.display='inline';
        }
        function print_diff(count){
            //clean history
            document.getElementById("textarea_only_aa").innerHTML='';
            document.getElementById("textarea_only_bb").innerHTML='';
            document.getElementById("textarea_share").innerHTML='';
            let aa_arr=document.getElementById("textarea_aa").value.split('\n');
            let bb_arr=document.getElementById("textarea_bb").value.split('\n');
            let aa_map=new Map();
            let bb_map=new Map();
            aa_arr.forEach(element => {
                aa_map.set(element,aa_map.get(element)===undefined?1:aa_map.get(element)+1);
            });
            bb_arr.forEach(element => {
                bb_map.set(element,bb_map.get(element)===undefined?1:bb_map.get(element)+1);
            });
            aa_arr=[];
            bb_arr=[];
            if(count){
                aa_map.forEach((v,k)=>{
                    aa_arr.push(k+'&'+v);
                });
                bb_map.forEach((v,k)=>{
                    bb_arr.push(k+'&'+v);
                });
            }else{
                aa_map.forEach((v,k)=>{
                    aa_arr.push(k);
                });
                bb_map.forEach((v,k)=>{
                    bb_arr.push(k);
                });
            }
            //only in aa
            let aa_only='';
            aa_arr.filter((i)=>!bb_arr.includes(i)).forEach((i)=>{
                aa_only=aa_only+i+'\n';
            });
            //only in bb
            let bb_only='';
            bb_arr.filter((i)=>!aa_arr.includes(i)).forEach((i)=>{
                bb_only=bb_only+i+'\n';
            });
            //share
            let share='';
            aa_arr.filter((i)=>bb_arr.includes(i)).forEach((i)=>{
                share=share+i+'\n';
            });
            document.getElementById("textarea_only_aa").innerHTML=aa_only;
            document.getElementById("textarea_only_bb").innerHTML=bb_only;
            document.getElementById("textarea_share").innerHTML=share;
        }
        //tool 2 function ---
        function clean_tool_2(){
            document.getElementById("after_string").innerHTML='';
            document.getElementById("before_string").value='';
        }
        function show_tool_2(){
            document.getElementById("index").style.display='none';
            document.getElementById("tool_2").style.display='inline';
        }
        function format_string(){
            //clean history
            document.getElementById("after_string").innerHTML='';
            let before_string=document.getElementById("before_string").value.split('\n');
            let after_string=new String();
            before_string.forEach((element)=>{
                after_string=after_string+'\''+element+'\','+'\n';
            });
            after_string=after_string.substr(0,after_string.length-2);
            document.getElementById("after_string").innerHTML=after_string;
        }
        //tool 3 function ---
        function clean_tool_3(){
            document.getElementById("after_decode_string").innerHTML='';
            document.getElementById("before_decode_string").value='';
        }
        function show_tool_3(){
            document.getElementById("index").style.display='none';
            document.getElementById("tool_3").style.display='inline';
        }
        function decode_string(){
            document.getElementById("after_decode_string").innerHTML=decodeURIComponent(document.getElementById("before_decode_string").value);
        }
        //tool 4 function ---
        var codes;
        var code;
        var refreshInterval;
        let instance=axios.create({
            //腾讯 tx
            baseURL:'https://qt.gtimg.cn'//v_s_sh600108="1~亚盛集团~600108~3.00~-0.10~-3.23~568256~17082~~58.41~GP-A";
        });
        function refreshfun4(){
            console.log('refresh run: '+codes);
            try{
                document.getElementById("trade_result").innerHTML='';
                codes.forEach((element)=>{
                    instance.get('/q='+code+element).then((res)=>{
                        let data=res.data.split('~');
                        let tx_data=data[2]+'  '+data[3]+'  '+data[4]+'  '+data[5]+'%'
                        if(document.getElementById("trade_result").innerHTML!=''){
                            document.getElementById("trade_result").innerHTML=document.getElementById("trade_result").innerHTML+'\n'+tx_data;
                        }else{
                            document.getElementById("trade_result").innerHTML=tx_data;
                        }
                    }).catch((e)=>{console.log(e)});
                });
            }catch(err){
                console.log(err);
                stopInterval();
            }
        }
        function stopInterval(){
            if(refreshInterval!=undefined||refreshInterval!=null){
                clearInterval(refreshInterval);
                refreshInterval=null;
            }
        }
        function clean_tool_4(){
            stopInterval();
            codes=null;
            code=null;
            document.getElementById("trade_result").innerHTML='';
            document.getElementById("trade_code").value='';
        }
        function show_tool_4(){
            document.getElementById("index").style.display='none';
            document.getElementById("tool_4").style.display="inline";
        }
        function trade_refresh(){
            //clean history
            document.getElementById("trade_result").innerHTML='';
            stopInterval();
            codes=document.getElementById("trade_code").value.split('\n');
            code=document.getElementById("trade_select_code").value;
            refreshInterval=setInterval(refreshfun4,3000)
        }
    </script>
</html>